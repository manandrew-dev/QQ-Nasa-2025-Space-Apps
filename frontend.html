<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NASA Weather Prediction Demo</title>
  <style>
    body { font-family: sans-serif; background: #0a0a0a; color: white; text-align: center; }
    input, button { margin: 6px; padding: 6px; font-size: 1em; }
    img { margin-top: 15px; border-radius: 8px; max-width: 90%; }
    .result { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>NASA Space Apps: Weather Probability</h1>
  <div>
    <input type="number" id="lat" placeholder="Latitude (e.g. -33.87)" step="0.01">
    <input type="number" id="lon" placeholder="Longitude (e.g. 151.21)" step="0.01"><br>
    <input type="date" id="date" value="2025-10-01">
    <input type="time" id="time" value="12:00">
    <input type="number" id="tzone" placeholder="Timezone offset" value="0"><br>
    <button onclick="calculate()">Get Weather</button>
  </div>

  <div class="result" id="result"></div>

  <script>
    async function calculate() {
      const lat = parseFloat(document.getElementById('lat').value);
      const lon = parseFloat(document.getElementById('lon').value);
      const date = document.getElementById('date').value;
      const time = document.getElementById('time').value;
      const tzone = parseInt(document.getElementById('tzone').value);

      document.getElementById('result').innerHTML = "<p>⏳ Loading...</p>";

      try {
        const res = await fetch("http://localhost:3000/api/calculate_prob", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ coords: [lat, lon], date, time, tzone })
        });
        const data = await res.json();

        if (data.error) throw new Error(data.error);

        document.getElementById('result').innerHTML = `
          <p><strong>Average Precipitation:</strong> ${data.average_precipitation_mm_per_hr} mm/hr</p>
          <p><strong>Rain Probability:</strong> ${data.rain_probability_percent}%</p>
          <p><strong>Category:</strong> ${data.rain_intensity_category}</p>
          <img src="${data.chart_image_base64}" alt="Historical Precipitation Chart">
        `;
      } catch (err) {
        document.getElementById('result').innerHTML = `<p style="color:red;">❌ Error: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
